<?xml version="1.0" encoding="UTF-8"?>
<XMLDB PATH="mod/zoomattendance/db" VERSION="2025110100" COMMENT="XMLDB file for Zoom Meeting Attendance">
    <TABLES>
        <TABLE NAME="zoomattendance" COMMENT="Stores Zoom meeting session data">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="course" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Course ID"/>
                <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false"/>
                <FIELD NAME="intro" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
                <FIELD NAME="introformat" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
                <FIELD NAME="meeting_id" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Zoom meeting ID or UUID"/>
                <FIELD NAME="meetingurl" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Optional meeting URL"/>
                <FIELD NAME="organizer_email" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false"/>
                <FIELD NAME="expected_duration" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
                <FIELD NAME="required_attendance" TYPE="int" LENGTH="3" NOTNULL="true" DEFAULT="75" SEQUENCE="false"/>
                <FIELD NAME="completionattendance" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether attendance is required for completion"/>
                <FIELD NAME="status" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="open" SEQUENCE="false"/>
                <FIELD NAME="start_datetime" TYPE="int" LENGTH="10" NOTNULL="false" DEFAULT="0" SEQUENCE="false" COMMENT="Start datetime for filtering attendance reports"/>
                <FIELD NAME="end_datetime" TYPE="int" LENGTH="10" NOTNULL="false" DEFAULT="0" SEQUENCE="false" COMMENT="End datetime for filtering attendance reports"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="course" TYPE="foreign" FIELDS="course" REFTABLE="course" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="course" UNIQUE="false" FIELDS="course"/>
            </INDEXES>
        </TABLE>
        <TABLE NAME="zoomattendance_data" COMMENT="Stores attendance data for Zoom meetings">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="sessionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to zoomattendance.id"/>
                <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="The user ID of the participant"/>
                <FIELD NAME="zoom_user_id" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The Zoom user identifier"/>
                <FIELD NAME="zoom_user_email" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The Zoom user email"/>
                <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Participant name from Zoom"/>
                <FIELD NAME="join_time" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Join timestamp"/>
                <FIELD NAME="leave_time" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Leave timestamp"/>
                <FIELD NAME="duration" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Duration in seconds"/>
                <FIELD NAME="attendance_duration" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Duration of attendance in seconds"/>
                <FIELD NAME="actual_attendance" TYPE="int" LENGTH="3" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Actual percentage of attendance"/>
                <FIELD NAME="completion_met" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether the completion criteria were met (1 for yes, 0 for no)"/>
                <FIELD NAME="role" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="Attendee" SEQUENCE="false" COMMENT="User's role in the meeting"/>
                <FIELD NAME="manually_assigned" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether the user was manually assigned (1) or automatically assigned (0)"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="sessionid" TYPE="foreign" FIELDS="sessionid" REFTABLE="zoomattendance" REFFIELDS="id"/>
                <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="userid" UNIQUE="false" FIELDS="userid"/>
                <INDEX NAME="sessionid_zoom" UNIQUE="false" FIELDS="sessionid, zoom_user_id"/>
            </INDEXES>
        </TABLE>
        <TABLE NAME="zoomattendance_reports" COMMENT="Stores reports generated for Zoom meetings">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="data_id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to zoomattendance_data.id"/>
                <FIELD NAME="report_id" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="The Zoom report identifier"/>
                <FIELD NAME="join_time" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp when user joined the meeting"/>
                <FIELD NAME="leave_time" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp when user left the meeting"/>
                <FIELD NAME="attendance_duration" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Duration of attendance in seconds"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="data_id" TYPE="foreign" FIELDS="data_id" REFTABLE="zoomattendance_data" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="data_id" UNIQUE="false" FIELDS="data_id"/>
            </INDEXES>
        </TABLE>
        <TABLE NAME="zoomattendance_blacklist" COMMENT="Blacklist of Zoom users to exclude from attendance">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="zoom_user_id" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false"/>
                <FIELD NAME="zoom_user_email" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false"/>
                <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false"/>
                <FIELD NAME="reason" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="zoom_user_id" UNIQUE="true" FIELDS="zoom_user_id"/>
            </INDEXES>
        </TABLE>
    </TABLES>
</XMLDB>
